## 1问题
哪些时间段延迟低
哪些时间容易断网

## 2数据来源
这里使用的是一款PingInfoView的软件，能在图形化界面中自动进行ping操作，并进行日志记录（这里记录间隔为1s），默认格式为csv
[ping_log文件概览+属性大小]

## 3数据处理
加载数据
        
        names = ['time','url','ip1','empty','ip2','delay','ttl','status']
        tb = Table(r'd:\data analysis\dataset\wifi\ping_log.csv',encoding='gbk',names = names )
这里的Table类继承了pandas的DataFrame类，并封装了read_csv方法，见excel.py[url]
![](http://q14cwxl8t.bkt.clouddn.com/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20191117154056.jpg)

去除无关列

       tb = tb.get('',['time','delay'])
       [excel] 

初步观察数据后发现，delay列中存在数据缺失，不难发现这是丢包情况产生的
为了保持数据类型一致性，便于后续分析，将丢包情况下的延迟设为1000ms

        tb = tb.get('',['time','delay']).fillna(1000)

将初步处理的数据进行保存，便于后续分析
        
        tb.save('data.pkl')

加载数据包
        
        tb = Table('data.pkl')
        tb.info()
        [info]

将time列数据类型转为datetime，同时将delay列转为int型
        
        tb['datetime'] = Column(tb['datetime']).to_datetime(errors='coerce')
        tb = tb.dtype('int',['delay'])

新建hour列，代表每个时间段（间隔1小时）的起始时间
        
        tb['hour'] = tb['datetime'].map(lambda dt:dt.hour)

保存数据，便于后续分析
        
        tb.save('data.pkl')


## 4数据分析
针对问题1，计算每个时间段的平均延迟，并进行排序

        tb.groupby(by='hour').agg({'delay':'mean'}).sort_values(ascending=True)

                   delay
        hour            
        9.0   145.404011
        8.0   174.323472
        15.0  178.745048
        13.0  190.394015
        16.0  195.633187
        12.0  205.282659
        7.0   207.589330
        14.0  212.812898
        19.0  221.870495
        10.0  231.361168
        11.0  248.143496
        17.0  274.658666
        6.0   275.404528
        4.0   278.101013
        20.0  299.666995
        21.0  311.468117
        18.0  326.338240
        22.0  347.529785
        5.0   375.986196
        23.0  386.008496
        0.0   541.010231
        1.0   598.681771
        3.0   667.059647
        2.0   769.647361

可以看到延迟较低的时间段主要集中在上午7点-10点，以及下午的13点-17点，这也符合大多数人白天工作、外出的情况
延迟最高的是在23点-次日4点，其中0点以后延迟有比较大的增长

        11.0    0.202289
        6.0     0.217906
        17.0    0.235705
其中这些饭点较网络空闲时延迟明显提升

进一步分析，按照时间顺序，计算延迟变化情况
tb.reset_index().sort_values(by='hour',ascending=True).set_index('hour').pct_change()

                 delay
        hour          
        0.0        NaN
        1.0   0.106600
        2.0   0.285570
        3.0  -0.133292
        4.0  -0.583094
        5.0   0.351977
        6.0  -0.267514
        7.0  -0.246239
        8.0  -0.160248
        9.0  -0.165895
        10.0  0.591161
        11.0  0.072537
        12.0 -0.172726
        13.0 -0.072528
        14.0  0.117750
        15.0 -0.160084
        16.0  0.094482
        17.0  0.403947
        18.0  0.188159
        19.0 -0.320121
        20.0  0.350639
        21.0  0.039381
        22.0  0.115780
        23.0  0.110721

折线图观察
对变化率取绝对值，这个指标在某种程度上反应用户的行为波动情况

        a = tb.reset_index().sort_values(by='hour',ascending=True).set_index('hour').pct_change()
        a['delay'] = abs(a['delay'])
        a.plot()
        plt.show()

[image]

图中看到，凌晨4点左右出现一个峰值，随后变化率逐步下降，在上午10点左右出现第二个峰值
随后是下午5点左右，7点和8点左右，其余时间变化率都不超过0.3，并不明显

变化率出现峰值，代表用户此时网络行为变化剧烈，情形无外乎：
1使用人数突然增加或减少
2突然开启或关闭流量应用 

凌晨4点人数不可能增加，结合上面的延迟数据，可以推断应该属于突然关闭流量应用情形
结合日常知识和统计的一般性，附近某人有4点左右入睡习惯

对于上午10点的峰值，结合延迟数据，可以推断应该属于开启流量应用情形
结合日常知识和统计的一般性，附近某人有10点左右上网的习惯


针对问题2，对每个时间段的丢包次数进行统计，并计算丢包百分比

        a = tb.groupby(by='hour').apply(lambda x:x['delay'].value_counts(normalize=True)[1000])\
            .sort_values(ascending=True)

        hour
        9.0     0.088406
        15.0    0.119429
        8.0     0.121248
        13.0    0.144711
        7.0     0.155531
        16.0    0.155686
        12.0    0.159872
        14.0    0.162106
        10.0    0.173447
        19.0    0.173877
        11.0    0.202289
        6.0     0.217906
        17.0    0.235705
        20.0    0.240915
        4.0     0.252534
        21.0    0.256912
        18.0    0.285866
        22.0    0.296263
        5.0     0.332884
        23.0    0.340050
        0.0     0.515183
        1.0     0.584680
        3.0     0.623322
        2.0     0.748577
        dtype: float64


可以观察到，丢包和延迟率的时间分布基本相同
0点以后丢包率明显提升

## 5总结
应该尽量选择在白天上网。其中，低延迟的最佳时间段是9点-10点，此时适合浏览网页、查询资料

尽可能避开吃饭时间段，6点到7点，11点到12点，17点到18点

意外收获： “0点”现象，邻居了解


